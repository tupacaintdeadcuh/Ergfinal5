async function ensureLogin(){const r=await fetch('/api/user',{credentials:'include'});const me=await r.json();if(!me.loggedIn){document.getElementById('need-login').classList.remove('hidden');return null}document.getElementById('need-login').classList.add('hidden');document.getElementById('board').classList.remove('hidden');return me}
async function loadSubs(){const r=await fetch('/api/admin/submissions',{credentials:'include'});const j=await r.json();const tb=document.querySelector('#tbl-subs tbody');tb.innerHTML='';(j.rows||[]).forEach(row=>{const tr=document.createElement('tr');const when=new Date(row.when).toLocaleString();const user=row.user?`${row.user.username}#${row.user.discriminator}`:'-';tr.innerHTML=`<td>${when}</td><td>${row.type}</td><td>${user}</td><td><pre style="white-space:pre-wrap">${JSON.stringify(row.data,null,2)}</pre></td>`;tb.appendChild(tr)})}
document.getElementById('btn-login').onclick=()=>{location.href='/auth/discord'};document.getElementById('btn-logout').onclick=async()=>{await fetch('/logout',{method:'POST'});location.reload()};(async()=>{const me=await ensureLogin();if(me)loadSubs()})()